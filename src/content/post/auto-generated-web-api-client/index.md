---
title: "Auto generated WebAPI client library"
description: "How to configure C# project to auto-generate nuget package with WebAPI client using NSwag"
date: 2020-09-02T00:11:45+02:00
tags : ["NSwag", "AspCore", "C#", "WebAPI", "Rest"]
highlight: true
image: "splashscreen.jpg"
isBlogpost: true
---

In the era of microservices and distributed systems, not only web browser applications written in `JavaScript` are the consumers of the `REST API`. Today, more and more often this type of communication is used to connect backend services too. Integrating two services using REST protocol doesn't require any form of sharable contract which makes the process extremely easy (more loosely decoupled) but it comes with own price. At the end of day we always need to write some set of classes which act as client proxy, and if there are more than one consumer of a given service we need to repeat that work in everyone of them. Another problem is with propagating information about changes in the API and adjusting all client to those changes. Taking account those disadvantage it's worth to consider publishing a client proxy alongside with the service itself, especially if it's possible to generate it automatically. There's a couple of existing projects on the market that allow to generate C# client from `OpenAPI` (`Swagger`) specification like:

- [swagger-codegen](https://swagger.io/tools/swagger-codegen/)
- [openapi-generator](https://github.com/OpenAPITools/openapi-generator)
- [NSwag](https://github.com/RicoSuter/NSwag). 

`swagger-codegen` and `openapi-generator` are Java based CLI tools, so they require `JVM` to run but they allows to generate Rest API clients in verity of programming languages. `NSwag` is built with dotnet but supports only `C#` and `TypeScript` clients generation. Anyway I decided to use `NSwag` because it was the easiest one to integrated with `MsBuild` and allows for generating client directly from WebAPI server assembly. Although there's a plenty of article about generating C# client using NSwag, it took me a whole day to put all necessary pieces together so I decided to write my own description for future reference.

## Project organization

- `MyService` - this is AspCore WebAPI project providing REST endpoints
- `MyService.ApiClient` - responsible for producing `dll` as well as `nuget package` with REST client based on the MyService project's output assembly
- `MyService.ComponentTest` - contains components test for MyService using [in-memory test server](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.testhost.testserver?view=aspnetcore-3.0). Tested API is always called via client generated by `MyService.ApiClient` project

## Steps to configure automated client generation

### Prepare `nswag.json` manifest

`nswag.json` defines set of parameters required by NSwag for generating client code like input assembly and output file path as well as other different options allowing to adjust the shape of output code to our needs. The easiest way to generate this manifest file is to use Windows UI application called [NSwag Studio](https://github.com/RicoSuter/NSwag/wiki/NSwagStudio).
Here's the minimal configuration required to correctly generate C# client:



After achieving the desired output, we should save the current configuration as `nswag.json` file directly in `MyService.ApiClient` project's directory. 

### Configure build of ApiClient project